{% extends "base/company_admin.html" %}
<!--Import Base Template-->
{% block title %}
    Billing
{% endblock %}
<!--Set Title-->

{% block head %}

    <style>
    .StripeElement {
      box-sizing: border-box;

      height: 40px;

      padding: 10px 12px;

      border: 1px solid transparent;
      border-radius: 4px;
      background-color: white;

      box-shadow: 0 1px 3px 0 #e6ebf1;
      -webkit-transition: box-shadow 150ms ease;
      transition: box-shadow 150ms ease;
    }

    .StripeElement--focus {
      box-shadow: 0 1px 3px 0 #cfd7df;
    }

    .StripeElement--invalid {
      border-color: #fa755a;
    }

    .StripeElement--webkit-autofill {
      background-color: #fefde5 !important;
    }
  </style>


{% endblock %}

{% block main %}
<!--Page code here-->

<!-- Page Heading -->
<br>
     <h1 class="mb-4 text-gray-800">Billing Info & Monthly Usage</h1>
        <br>
        <div class="row">

          <div class="col">

            <div class="card">
              <div class="card-header bg-dark text-light font-weight-light">
                Monthly Usage <i class="far fa-chart-bar fa-lg"></i>
              </div>
              <div class="card-body">



                <h5 class="font-weight-light"><i class="fas fa-clipboard-list"></i> {{report_count}} reports filed</h5>

                <div class="text-right">
                  <br>
                  <hr>
                  <h5 class="font-weight-light">{{report_count}} Reports x
                    {{"$%.2f"|format(report_price)}}</h5>
                  <br>

                  <hr>

                  <h5 class="font-weight-light">Subtotal
                    {{"$%.2f"|format(report_price * report_count)}}</h5>



                  <p class="font-weight-light">Wa Sales Tax
                    {{"$%.2f"|format(0.1* (report_price * report_count))}}</p>

                  <h5 class="font-weight-light">Monthly Bill
                    {{"$%.2f"|format(1.1* (report_price * report_count))}}</h5>
                  <hr>
                  <br>
                </div>
                <h5 class="font-weight-light"><i class="fas fa-calendar-alt fa-lg"></i> Billing Cycle: {{start_date}} -
                  {{end_date}}</h5>
                <br>
                <br>
                <small class="font-weight-light text-uppercase ">Note: You Are Automatically Billed For Filed Reports When They Are Filed</small>
              </div>
            </div>


          </div>


          <div class="col">

            <div class="card">
              <div class="card-header font-weight-light bg-dark text-light">
                Payment Info
              </div>
              <div class="card-body">

              <div class="container-fluid mx-auto">
                {% if card_brand == 'Visa' %}

                <h5 class="font-weight-light"><i class="fab fa-cc-visa fa-5x"></i> ending in
                  {{last_4}}</h5>

                {% elif card_brand == 'American express' %}

                <h5 class="font-weight-light"><i class="fab fa-cc-amex fa-5x"></i> ending in
                  {{last_4}}</h5>

                {% elif card_brand == 'Mastercard' %}

                <h5 class="font-weight-light"><i class="fab fa-cc-mastercard fa-5x"></i> ending in
                  {{last_4}}</h5>


                {% elif card_brand == 'Discover' %}

                <h5 class="font-weight-light"><i class="fab fa-cc-discover fa-5x"></i> ending in
                  {{last_4}}</h5>


                {% else %}

                <h5 class="font-weight-light">{{card_brand}} ending in {{last_4}}</h5>

                {% endif %}
              </div>




                <br>
              <h5 class="font-weight-light">Change Payment Method <i class="fas fa-money-check"></i></h5>
                <br>
                <script src="https://js.stripe.com/v3/"></script>
                <form action="update-card" method="post" id="payment-form">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                  <div class="form-row">
                    <div class="w-100" id="card-element">
                      <!-- A Stripe Element will be inserted here. -->
                    </div>

                    <!-- Used to display form errors. -->
                    <div class="w-100" id="card-errors" role="alert"></div>
                  </div>
                  <br>
                  <button class="btn btn-lg btn-secondary font-weight-light">Change Card</button>
                </form>

                <br>
                <br>
                <br>
              </div>
            </div>
          </div>
        </div>




{% block script %}


    <script>
    var stripe = Stripe('pk_test_AaYl7GVGtjGAayU9XYcNv8NN00CFTpfUSx');

    // Create an instance of Elements.
    var elements = stripe.elements();

    // Custom styling can be passed to options when creating an Element.
    // (Note that this demo uses a wider set of styles than the guide below.)
    var style = {
      base: {
        color: '#32325d',
        fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
        fontSmoothing: 'antialiased',
        fontSize: '16px',
        '::placeholder': {
          color: '#aab7c4'
        }
      },
      invalid: {
        color: '#fa755a',
        iconColor: '#fa755a'
      }
    };

    // Create an instance of the card Element.
    var card = elements.create('card', {
      style: style
    });

    // Add an instance of the card Element into the `card-element` <div>.
    card.mount('#card-element');

    // Handle real-time validation errors from the card Element.
    card.addEventListener('change', function (event) {
      var displayError = document.getElementById('card-errors');
      if (event.error) {
        displayError.textContent = event.error.message;
      } else {
        displayError.textContent = '';
      }
    });

    // Handle form submission.
    var form = document.getElementById('payment-form');
    form.addEventListener('submit', function (event) {
      event.preventDefault();

      stripe.createToken(card).then(function (result) {
        if (result.error) {
          // Inform the user if there was an error.
          var errorElement = document.getElementById('card-errors');
          errorElement.textContent = result.error.message;
        } else {
          // Send the token to your server.
          stripeTokenHandler(result.token);
        }
      });
    });

    // Submit the form with the token ID.
    function stripeTokenHandler(token) {
      // Insert the token ID into the form so it gets submitted to the server
      var form = document.getElementById('payment-form');
      var hiddenInput = document.createElement('input');
      hiddenInput.setAttribute('type', 'hidden');
      hiddenInput.setAttribute('name', 'stripe_token');
      hiddenInput.setAttribute('value', token.id);
      form.appendChild(hiddenInput);

      // Submit the form
      form.submit();
    }
  </script>

{% endblock %}
<!--END-->
{% endblock %}